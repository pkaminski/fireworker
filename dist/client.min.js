!function(){"use strict";function a(a,b,c){return a=d(a,c),b?a.then(function(a){return b(null,a),a},function(a){return b(a),Promise.reject(a)}):a}function b(a,b,c,d){for(var e="all"===b?Object.keys(a):[b],f=0,g=e;f<g.length;f+=1){var h=g[f];a[h].push({timeout:c,callback:d,count:0})}return d}function c(a,b,c){for(var d="all"===b?Object.keys(a):[b],e=0,f=d;e<f.length;e+=1)for(var g=f[e],h=a[g],i=0;i<h.length;i++)if(h[i].callback===c){h.splice(i,1);break}}function d(a,b){function c(){for(var a=0,b=e;a<b.length;a+=1){var c=b[a];c.handleDone()}}var d=l[b];if(!d.length)return a;var e=d.map(function(a){return new v(a)});return a=a.then(function(a){return c(),a},function(a){return c(),Promise.reject(a)})}function e(a,b){var c=m[b];if(c&&c.length){var d=c.map(function(a){return new v(a)});a.acknowledge=function(a){for(var b=0,c=d;b<c.length;b+=1){var e=c[b];e.handleDone()}}}}function f(a){if(!a||a instanceof Error)return a;var b=new Error(a.message);for(var c in a)if("message"!==c&&a.hasOwnProperty(c))try{b[c]=a[c]}catch(a){throw a.extra={propertyName:c},a}return b}function g(a){k.length&&setTimeout(function(){for(var b=0,c=k;b<c.length;b+=1){var d=c[b];d(a)}},0)}function h(a){var b=a.indexOf("/",8);return b>=8?a.slice(0,b):a}function i(){}var j,k=[],l={read:[],write:[],auth:[],onDisconnect:[]},m={read:[],write:[],auth:[],onDisconnect:[]},n="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",o=1<<31,p=2147483647,q={authWithCustomToken:"auth",authAnonymously:"auth",authWithOAuthToken:"auth",set:"write",update:"write",transaction:"write",on:"read",once:"read",onDisconnect:"onDisconnect"},r=function(a){var b=a.url,c=a.childrenKeys,d=a.value,e=a.valueError,g=a.exists,h=a.hasChildren;this._url=b.replace(/\/$/,""),this._childrenKeys=c,this._value=d,this._valueError=f(e),this._exists=void 0===d?g||!1:null!==d,this._hasChildren="object"==typeof d||h||!1};r.prototype.exists=function(){return this._exists},r.prototype.val=function(){return this._checkValue(),this._value},r.prototype.exportVal=function(){return this.val()},r.prototype.child=function a(b){var c=b.split("/"),a=this._getChildValue(c);return new r({url:this._url+"/"+c.map(encodeURIComponent).join("/"),value:a,exists:void 0!==a,hasChildren:"object"==typeof a})},r.prototype.forEach=function(a){var b=this;if(this._checkValue(),!this._hasChildren)return!1;if(!this._childrenKeys){this._childrenKeys=Object.keys(this._value);for(var c={},d=0,e=this._childrenKeys;d<e.length;d+=1){var f=e[d];if(/^[+-]?\d+$/.test(f)){var g=parseInt(f,10);if(g<=p&&g>=o){c[f]=g;continue}}c[f]=f}this._childrenKeys.sort(function(a,b){a=c[a],b=c[b];var d="number"==typeof a,e="number"==typeof b;return d^e?d?-1:1:a===b?0:a<b?-1:1})}for(var h=0,i=this._childrenKeys;h<i.length;h+=1){var j=i[h],k=b._value[j],l=new r({url:b._url+"/"+j,value:k,exists:void 0!==k,hasChildren:"object"==typeof k});if(a(l)===!0)return!0}return!1},r.prototype.hasChild=function(a){return null!==this._getChildValue(a.split("/"))},r.prototype.hasChildren=function(){return this._hasChildren},r.prototype.key=function(){return void 0===this._key&&(this._key=this._url.replace(/.*\//,"")),this._key},r.prototype.numChildren=function(){return this._checkValue(),this._childrenKeys?this._childrenKeys.length:0},r.prototype.ref=function(){return new u(this._url)},r.prototype._checkValue=function(){if(this._valueError)throw this._valueError;if(void 0===this._value)throw new Error("Value omitted from snapshot")},r.prototype._getChildValue=function(a){this._checkValue();for(var b=this._value,c=0,d=a;c<d.length;c+=1){var e=d[c];if(null===b||void 0===b)break;b=b[e]}return void 0===b&&(b=null),b};var s=function(a){this._url=a};s.prototype.set=function(b,c){return a(j.onDisconnect(this._url,"set",b),c,"onDisconnect")},s.prototype.update=function(b,c){return a(j.onDisconnect(this._url,"update",b),c,"onDisconnect")},s.prototype.remove=function(b){return a(j.onDisconnect(this._url,"remove"),b,"onDisconnect")},s.prototype.cancel=function(b){return a(j.onDisconnect(this._url,"cancel"),b,"onDisconnect")};var t=function(a,b){if(!j)throw new Error("Worker not connected");if("https://"!==a.slice(0,8))throw new Error('Firebase URL must start with "https://"');this._url=a.replace(/\/$/,""),this._terms=b};t.prototype.on=function(a,b,c,d){return"undefined"==typeof d&&"function"!=typeof c&&(d=c,c=void 0),j.on(this.toString(),this._url,this._terms,a,b,c,d,{omitValue:!!b.omitSnapshotValue,skipCurrent:!!b.skipCurrent,skipCallback:!!b.skipCallback}),b},t.prototype.off=function(a,b,c){return j.off(this.toString(),this._url,this._terms,a,b,c)},t.prototype.once=function(a,b,c,e){return"undefined"===e&&"function"!=typeof c&&(e=c,c=void 0),d(j.once(this._url,this._terms,a,{omitValue:!(!b||!b.omitSnapshotValue)}),"read").then(function(a){return b&&b.call(e,a),a},function(a){return c&&c.call(e,a),Promise.reject(a)})},t.prototype.ref=function(){return new u(this._url)},t.prototype.toString=function(){var a=this._url;if(this._terms){var b=this._terms.map(function(a){var b=a[0];return a.length>1&&(b+="="+encodeURIComponent(a.slice(1).map(function(a){return JSON.stringify(a)}).join(","))),b});b.sort(),a+="?"+b.join("&")}return a},["orderByChild","orderByKey","orderByValue","startAt","endAt","equalTo","limitToFirst","limitToLast"].forEach(function(a){t.prototype[a]=function(){var b=Array.prototype.slice.call(arguments);b.unshift(a);var c=this._terms?this._terms.slice():[];return c.push(b),new t(this._url,c)}});var u=function(e){function f(a){e.call(this,a),j.trackServer(h(a))}return e&&(f.__proto__=e),f.prototype=Object.create(e&&e.prototype),f.prototype.constructor=f,f.prototype.authWithCustomToken=function(b,c,d){return d||"object"!=typeof c||(d=c,c=null),a(j.authWithCustomToken(this._url,b,d),c,"auth")},f.prototype.authAnonymously=function(b,c){return c||"object"!=typeof b||(c=b,b=null),a(j.authAnonymously(this._url,c),b,"auth")},f.prototype.authWithOAuthToken=function(b,c,d,e){return e||"object"!=typeof d||(e=d,d=null),a(j.authWithCustomToken(this._url,b,c,e),d,"auth")},f.prototype.authWithPassword=function(){throw new Error("Interactive auth not supported by Fireworker")},f.prototype.authWithOAuthPopup=function(){throw new Error("Interactive auth not supported by Fireworker")},f.prototype.authWithOAuthRedirect=function(){throw new Error("Interactive auth not supported by Fireworker")},f.prototype.unauth=function(){return j.unauth(this._url)},f.prototype.onAuth=function(a,b){j.onAuth(h(this._url),a,b)},f.prototype.offAuth=function(a,b){j.offAuth(h(this._url),a,b)},f.prototype.getAuth=function(){return j.getAuth(h(this._url))},f.prototype.child=function(a){return new f(this._url+"/"+a.split("/").map(encodeURIComponent).join("/"))},f.prototype.parent=function(){var a=this._url.lastIndexOf("/");return a>=8?new f(this._url.slice(0,a)):null},f.prototype.root=function(){var a=h(this._url);return this._url===a?this:new f(a)},f.prototype.key=function(){return this._url.replace(/.*\//,"")},f.prototype.set=function(b,c){return a(j.set(this._url,b),c,"write")},f.prototype.update=function(b,c){return a(j.update(this._url,b),c,"write")},f.prototype.remove=function(b){return a(j.set(this._url,null),b,"write")},f.prototype.push=function(a,b){var c=this.child(j.generateUniqueKey(this.root()));if(!a)return c;var d=c.set(a,b);return c.then=d.then.bind(d),c.catch=d.catch.bind(d),d.finally&&(c.finally=d.finally.bind(d)),c},f.prototype.transaction=function(a,b,c){var e=this,g={applyLocally:void 0===c?a.applyLocally:c};["nonsequential","safeAbort"].forEach(function(b){return g[b]=a[b]});for(var h in g)g.hasOwnProperty(h)&&void 0===g[h]&&(g[h]=f.DefaultTransactionOptions[h]);return this.on("value",i),d(j.transaction(this._url,a,g),"write").then(function(a){return e.off("value",i),b&&b(null,a.committed,a.snapshot),a},function(a){return e.off("value",i),b&&b(a),Promise.reject(a)})},f.prototype.onDisconnect=function(){return new s(this._url)},f.connectWorker=function(a){if(j)throw new Error("Worker already connected");return j=new w(a),j.init()},f.preExpose=function(a){f.worker[a]=j.bindExposedFunction(a)},f.goOnline=function(){j.activate(!0)},f.goOffline=function(){j.activate(!1)},f.bounceConnection=function(){return j.bounceConnection()},f.enableLogging=function(){throw new Error("Global enableLogging() call must be made from within the worker process")},f.onError=function(a){return k.push(a),a},f.offError=function(a){var b=k.indexOf(a);b!==-1&&k.splice(b,1)},f.onSlow=function(a,c,d){return b(l,a,c,d)},f.offSlow=function(a,b){return c(l,a,b)},f.onUnsent=function(a,c,d){return b(m,a,c,d)},f.offUnsent=function(a,b){return c(m,a,b)},f.debugPermissionDeniedErrors=function(a,b,c){return j.debugPermissionDeniedErrors(a,b,c)},f}(t);u.ServerValue=Object.freeze({TIMESTAMP:Object.freeze({".sv":"timestamp"})}),u.DefaultTransactionOptions=Object.seal({applyLocally:!0,nonsequential:!1,safeAbort:!1}),u.ABORT_TRANSACTION_NOW=Object.create(null),u.worker={};var v=function(a){this.record=a,this.counted=!1,this.canceled=!1,this.handle=setTimeout(this.handleTimeout.bind(this),a.timeout)};v.prototype.handleTimeout=function(){this.canceled||(this.counted=!0,this.record.callback(++this.record.count,1,this.record.timeout))},v.prototype.handleDone=function(){this.canceled=!0,this.counted?this.record.callback(--this.record.count,-1,this.record.timeout):clearTimeout(this.handle)};var w=function(a){var b=this;this._idCounter=0,this._deferreds={},this._active=!0,this._servers={},this._callbacks={},this._simulatedTokenGenerator=null,this._maxSimulationDuration=5e3,this._simulatedCallFilter=null,this._inboundMessages=[],this._outboundMessages=[],this._flushMessageQueue=this._flushMessageQueue.bind(this),this._port=a.port||a,this._shared=!!a.port,this._port.onmessage=this._receive.bind(this),window.addEventListener("unload",function(){b._send({msg:"destroy"})}),setInterval(function(){b._send({msg:"ping"})},6e4)};w.prototype.init=function(){var a=this,b=[];try{var c=window.localStorage||window.sessionStorage;if(!c)return;for(var d=0;d<c.length;d++){var e=c.key(d);b.push({key:e,value:c.getItem(e)})}}catch(a){}return this._send({msg:"init",storage:b}).then(function(b){var c=b.exposedFunctionNames,d=b.firebaseSdkVersion;u.SDK_VERSION=d+" (over "+(a._shared?"shared ":"")+"fireworker)";for(var e=0,f=c;e<f.length;e+=1){var g=f[e];u.worker[g]=a.bindExposedFunction(g)}})},w.prototype.activate=function(a){this._active!==a&&(this._active=a,a&&(this._receiveMessages(this._inboundMessages),this._inboundMessages=[],this._outboundMessages.length&&setImmediate(this._flushMessageQueue)))},w.prototype.debugPermissionDeniedErrors=function(a,b,c){this._simulatedTokenGenerator=a,void 0!==b&&(this._maxSimulationDuration=b),this._simulatedCallFilter=c||function(){return!0}},w.prototype._send=function(a){var b=this;a.id=++this._idCounter;var c;if(a.oneWay)c=Promise.resolve();else{c=new Promise(function(c,d){b._deferreds[a.id]={resolve:c,reject:d}});var d=this._deferreds[a.id];d.promise=c,c.sent=new Promise(function(a){d.resolveSent=a}),e(d,q[a.msg]);for(var f in a)a.hasOwnProperty(f)&&(d[f]=a[f])}return!this._outboundMessages.length&&this._active&&setImmediate(this._flushMessageQueue),this._outboundMessages.push(a),c},w.prototype._flushMessageQueue=function(){this._port.postMessage(this._outboundMessages),this._outboundMessages=[]},w.prototype._receive=function(a){for(var b=this,c=0,d=a.data;c<d.length;c+=1){var e=d[c];if("acknowledge"===e.msg){var f=b._deferreds[e.id];f&&f.acknowledge&&f.acknowledge(e)}}this._active?this._receiveMessages(a.data):this._inboundMessages=this._inboundMessages.concat(a.data)},w.prototype._receiveMessages=function(a){for(var b=this,c=0,d=a;c<d.length;c+=1){var e=d[c],f=b[e.msg];if("function"!=typeof f)throw new Error("Unknown message: "+e.msg);f.call(b,e)}},w.prototype.bindExposedFunction=function(a){return function(){return this._send({msg:"call",name:a,args:Array.prototype.slice.call(arguments)})}.bind(this)},w.prototype.acknowledge=function(a){var b=this._deferreds[a.id];if(!b)throw new Error("fireworker received acknowledgement of inexistent call");b.resolveSent&&b.resolveSent()},w.prototype.resolve=function(a){var b=this._deferreds[a.id];if(!b)throw new Error("fireworker received resolution to inexistent call");delete this._deferreds[a.id],b.resolve(a.result)},w.prototype.reject=function(a){var b=this._deferreds[a.id];if(!b)throw new Error("fireworker received rejection of inexistent call");delete this._deferreds[a.id],this._hydrateError(a.error,b).then(function(a){b.reject(a),g(a)})},w.prototype._hydrateError=function(a,b){var c=f(a),d=a.code||a.message;return d&&"permission_denied"===d.toLowerCase()?this._simulateCall(b).then(function(a){return a&&(c.extra=c.extra||{},c.extra.debug=a),c}):Promise.resolve(c)},w.prototype._simulateCall=function(a){var b=this;if(!(this._simulatedTokenGenerator&&this._maxSimulationDuration>0))return Promise.resolve();var c=[];switch(a.msg){case"set":c.push({method:"set",url:a.url,args:[a.value]});break;case"update":c.push({method:"update",url:a.url,args:[a.value]});break;case"on":case"once":c.push({method:"once",url:a.url,args:["value"]});break;case"transaction":c.push({method:"once",url:a.url,args:["value"]}),c.push({method:"set",url:a.url,args:[a.newValue]})}if(!c.length||!this._simulatedCallFilter(a.msg,a.url))return Promise.resolve();var d=this.getAuth(h(a.url)),e=this._simulatedTokenGenerator(d&&d.uid).then(function(a){return Promise.all(c.map(function(c){return c.msg="simulate",c.token=a,b._send(c)}))}).then(function(a){return a.every(function(a){return null===a})?"Unable to reproduce error in simulation":a.filter(function(a){return a}).join("\n\n")}).catch(function(a){return"Error running simulation: "+a}),f=new Promise(function(a){setTimeout(a.bind(null,"Simulated call timed out"),b._maxSimulationDuration)});return Promise.race([e,f])},w.prototype.updateLocalStorage=function(a){try{var b=window.localStorage||window.sessionStorage;for(var c in a)null===c.value?b.removeItem(c.key):b.setItem(c.key,c.value)}catch(a){}},w.prototype.trackServer=function(a){if(!this._servers.hasOwnProperty(a)){var b=this._servers[a]={offset:0,lastUniqueKeyTime:0,lastRandomValues:[],authListeners:[]},c=this._registerCallback(this._authCallback.bind(this,b)),d=a+"/.info/serverTimeOffset";this.on(d,d,[],"value",function(a){b.offset=a.val()}),this._send({msg:"onAuth",url:a,callbackId:c})}},w.prototype.generateUniqueKey=function(a){var b=this._servers[a];if(!b)throw new Error("Internal assertion failure: server not initialized for "+a);for(var c=Date.now()+b.offset,d=new Array(20),e=c,f=7;f>=0;f--)d[f]=n.charAt(63&e),e=Math.floor(e/64);if(c===b.lastUniqueKeyTime){for(var g=11;g>=0&&63===b.lastRandomValues[g];)b.lastRandomValues[g]=0,g-=1;if(g===-1)throw new Error("Internal assertion failure: ran out of unique IDs for this millisecond");b.lastRandomValues[g]+=1}else for(var h=0;h<12;h++)b.lastRandomValues[h]=Math.floor(Math.random()*(h?64:16));for(var i=0;i<12;i++)d[i+8]=n[b.lastRandomValues[i]];return d.join("")},w.prototype._authCallback=function(a,b){a.auth=b;for(var c=0,d=a.authListeners;c<d.length;c+=1){var e=d[c];e(b)}},w.prototype.onAuth=function(a,b,c){var d=b.bind(c);d.callback=b,d.context=c,this._servers[a].authListeners.push(d),d(this.getAuth(a))},w.prototype.offAuth=function(a,b,c){for(var d=this._servers[a].authListeners,e=0;e<d.length;e++){var f=d[e];if(f.callback===b&&f.context===c){d.splice(e,1);break}}},w.prototype.getAuth=function(a){return this._servers[a].auth},w.prototype.authWithCustomToken=function(a,b,c){return this._send({msg:"authWithCustomToken",url:a,authToken:b,options:c})},w.prototype.authAnonymously=function(a,b){return this._send({msg:"authAnonymously",url:a,options:b})},w.prototype.authWithOAuthToken=function(a,b,c,d){return this._send({msg:"authWithOAuthToken",url:a,provider:b,credentials:c,options:d})},w.prototype.unauth=function(a){return this._send({msg:"unauth",url:a})},w.prototype.set=function(a,b){return this._send({msg:"set",url:a,value:b})},w.prototype.update=function(a,b){return this._send({msg:"update",url:a,value:b})},w.prototype.on=function(a,b,c,d,e,f,g,h){var i={listenerKey:a,eventType:d,snapshotCallback:e,cancelCallback:f,context:g,msg:"on",url:b,terms:c,timeouts:l.read.map(function(a){return new v(a)})},j=this._onCallback.bind(this,i);this._registerCallback(j,i),e.__callbackIds=e.__callbackIds||[],e.__callbackIds.push(i.id),this._send({msg:"on",listenerKey:a,url:b,terms:c,eventType:d,callbackId:i.id,options:h}).catch(function(a){j(a)})},w.prototype.off=function(a,b,c,d,e,f){var g,h=this,i=[];if(e){if(e.__callbackIds)for(var j=0;j<e.__callbackIds.length;){var k=e.__callbackIds[j],l=h._callbacks[k];if(l){if(l.listenerKey===a&&l.eventType===d&&l.context===f){g=k,i.push(k),e.__callbackIds.splice(j,1);break}j+=1}else e.__callbackIds.splice(j,1)}if(!g)return}else for(var m=0,n=Object.keys(this._callbacks);m<n.length;m+=1){var o=n[m],p=h._callbacks[o];p.listenerKey!==a||d&&p.eventType!==d||i.push(o)}for(var q=0,r=i;q<r.length;q+=1){var s=r[q];h._nullifyCallback(s)}return this._send({msg:"off",listenerKey:a,url:b,terms:c,eventType:d,callbackId:g}).then(function(){for(var a=0,b=i;a<b.length;a+=1){var c=b[a];h._deregisterCallback(c)}})},w.prototype._onCallback=function(a,b,c){if(a.timeouts)for(var d=0,e=a.timeouts;d<e.length;d+=1){var f=e[d];f.handleDone()}b?(this._deregisterCallback(a.id),this._hydrateError(b,a).then(function(b){a.cancelCallback&&a.cancelCallback.call(a.context,b),g(b)})):a.snapshotCallback.call(a.context,new r(c))},w.prototype.once=function(a,b,c,d){return this._send({msg:"once",url:a,terms:b,eventType:c,options:d}).then(function(a){return new r(a)})},w.prototype.transaction=function(a,b,c){var d=this,e=0,f=function(g,h){if(e++>=25)return Promise.reject(new Error("maxretry"));var i;try{i=b(g)}catch(a){return Promise.reject(a)}return i===u.ABORT_TRANSACTION_NOW||void 0===i&&!c.safeAbort?{committed:!1,snapshot:new r({url:a,value:g})}:d._send({msg:"transaction",url:a,oldHash:h,newValue:i,options:c}).then(function(a){return a.stale?f(a.value,a.hash):{committed:a.committed,snapshot:new r(a.snapshotJson)}})};return f(null,null)},w.prototype.onDisconnect=function(a,b,c){return this._send({msg:"onDisconnect",url:a,method:b,value:c})},w.prototype.bounceConnection=function(){return this._send({msg:"bounceConnection"})},w.prototype.callback=function(a){var b=a.id,c=a.args,d=this._callbacks[b];if(!d)throw new Error("Unregistered callback: "+b);d.callback.apply(null,c)},w.prototype._registerCallback=function(a,b){return b=b||{},b.callback=a,b.id="cb"+ ++this._idCounter,this._callbacks[b.id]=b,b.id},w.prototype._nullifyCallback=function(a){var b=this._callbacks[a];if(b.timeouts)for(var c=0,d=b.timeouts;c<d.length;c+=1){var e=d[c];e.handleDone()}this._callbacks[a].callback=i},w.prototype._deregisterCallback=function(a){delete this._callbacks[a]},i.skipCallback=!0,window.Firebase=u}();
//# sourceMappingURL=client.min.js.map